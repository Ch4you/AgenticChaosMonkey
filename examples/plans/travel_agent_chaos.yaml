version: "1.0"
metadata:
  name: "Travel Agent Chaos Testing"
  description: "Chaos scenarios for testing travel booking agent resilience"
  experiment_id: "travel_agent_chaos_001"
  author: "Chaos Engineering Team"
  created_at: "2025-12-16"

classifier_rule_packs:
  - name: "prod-default"
    rules:
      llm_patterns:
        - "openai\\.com.*/v1/(chat|completions|embeddings)"
        - "anthropic\\.com.*/v1/messages"
      tool_patterns:
        - "localhost:8001"
        - ".*/search_flights.*"
        - ".*/book_ticket.*"
        - ".*/book.*"
      agent_patterns:
        - ".*agent-[a-z0-9]+.*"

targets:
  - name: "flight_search_api"
    type: "http_endpoint"
    pattern: ".*/search_flights.*"
    description: "Flight search API endpoint"
  
  - name: "booking_api"
    type: "http_endpoint"
    pattern: ".*/book_ticket.*|.*/book.*"
    description: "Flight booking API endpoint"
  
  - name: "travel_agent"
    type: "agent_role"
    pattern: "TravelAgent"
    description: "Travel agent role"

scenarios:
  # 延迟测试：模拟网络延迟（5秒）
  - name: "flight_search_delay"
    type: "latency"
    target_ref: "flight_search_api"
    enabled: true
    probability: 1.0
    params:
      delay: 5.0
  
  # 错误注入：模拟预订服务故障（50%概率）
  - name: "booking_failure"
    type: "error"
    target_ref: "booking_api"
    enabled: true
    probability: 0.5
    params:
      error_code: 500
      error_message: "Booking service unavailable"
  
  # 协议模糊测试：注入无效数据格式（测试Agent的容错性）
  - name: "flight_search_fuzzing"
    type: "mcp_fuzzing"
    target_ref: "flight_search_api"
    enabled: true
    probability: 0.7
    params:
      fuzz_type: "schema_violation"
      target_endpoint: "/search_flights"
      field_mode:
        date: "invalid_format"
        numeric: "type_mismatch"
        string: "buffer_overflow"
  
  # 组策略测试：针对特定角色的延迟（当前未使用）
  - name: "travel_agent_slowdown"
    type: "group_chaos"
    target_ref: "travel_agent"
    enabled: false
    probability: 1.0
    params:
      target_role: "TravelAgent"
      action: "latency"
      delay: 3.0

