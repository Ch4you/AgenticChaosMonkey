version: "1.0"
metadata:
  name: "Travel Agent Chaos (Production Profile)"
  description: "Production-like chaos profile with low probability failures and mixed fault types"
  experiment_id: "travel_agent_chaos_prod_001"
  author: "Chaos Engineering Team"
  created_at: "2026-01-18"

classifier_rule_packs:
  - name: "prod-default"
    rules:
      llm_patterns:
        - "openai\\.com.*/v1/(chat|completions|embeddings)"
        - "anthropic\\.com.*/v1/messages"
      tool_patterns:
        - "localhost:8001"
        - ".*/search_flights.*"
        - ".*/book_ticket.*"
        - ".*/book.*"
      agent_patterns:
        - ".*agent-[a-z0-9]+.*"

targets:
  - name: "flight_search_api"
    type: "http_endpoint"
    pattern: ".*/search_flights.*"
    description: "Flight search API endpoint"

  - name: "booking_api"
    type: "http_endpoint"
    pattern: ".*/book_ticket.*|.*/book.*"
    description: "Flight booking API endpoint"

  - name: "travel_agent"
    type: "agent_role"
    pattern: "TravelAgent"
    description: "Travel agent role"

scenarios:
  # Low-probability latency spikes
  - name: "flight_search_latency_spike"
    type: "latency"
    target_ref: "flight_search_api"
    enabled: true
    probability: 0.1
    params:
      delay: 1.5

  # Rare internal errors (500/503)
  - name: "booking_internal_error"
    type: "error"
    target_ref: "booking_api"
    enabled: true
    probability: 0.05
    params:
      error_code: 500
      error_message: "Booking service error"

  - name: "booking_unavailable"
    type: "error"
    target_ref: "booking_api"
    enabled: true
    probability: 0.03
    params:
      error_code: 503
      error_message: "Service unavailable"

  # Throttling (429) to simulate rate limits
  - name: "booking_rate_limit"
    type: "error"
    target_ref: "booking_api"
    enabled: true
    probability: 0.05
    params:
      error_code: 429
      error_message: "Rate limit exceeded"

  # Occasional schema corruption
  - name: "flight_search_fuzzing"
    type: "mcp_fuzzing"
    target_ref: "flight_search_api"
    enabled: true
    probability: 0.05
    params:
      fuzz_type: "schema_violation"
      target_endpoint: "/search_flights"
      field_mode:
        date: "invalid_format"
        numeric: "type_mismatch"
        string: "buffer_overflow"
